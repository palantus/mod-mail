<!doctype html>
<head>
<meta charset="utf-8" />
	<title>Mail</title>
	<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8,IE=edge" />
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="icon" sizes="196x196" href="/mail/img/mail_icon.png">
	<link rel="apple-touch-icon" sizes="196x196" href="/mail/img/mail_icon.png" />
	<link rel="icon" sizes="128x128" href="/mail/img/mail_small_icon.png">
	<link rel="apple-touch-icon" sizes="128x128" href="/mail/img/mail_small_icon.png" />
		
	<!-- To avoid background blinking on refresh -->
	<style>html{background-color: lightgrey}</style>

	<script src="/js/jquery.min.js"></script>
	<script src="/js/framework.js"></script>
	<!--<script src="/mail/js/mail.js"></script>-->
	
	<script>
		request({module:"mail", type: "GetRecentMailList", isSpam: getUrlVar("spam") == "true"}, function(res){
			var foundAny = false;
			for(i in res){
				var isHTML = res[i].bodyHTML != "" ? true : false;

				var header = $("<div/>", {class: "mailheader"});
				var to = $("<div/>", {html: "<span>To: </span>" + res[i].to});
				var from = $("<div/>", {html: "<span>From: </span>" + res[i].from});
				var subject = $("<div/>", {html: "<span>Subject: </span>" + res[i].title});

				header.append(from);
				header.append(to);
				header.append(subject);

				var body = $("<div/>", {class: "mailbody" + (isHTML?"":" plain"), html: (isHTML ? res[i].bodyHTML : res[i].bodyPlain)});

				var container = $("<div/>", {class: "mailcontainer"});
				container.append(header);
				container.append(body);

				$("#mails").append(container);
				foundAny = true;
			}

			if(!foundAny)
				$("#mails").append("<h4>Empty inbox...</h4>");
		}, function(err){
			$(function(){
				$("#errors").html(err.error);
			})
		});
	</script>

	<link rel="stylesheet" type="text/css" href="/mail/css/mail.css" />

</head>
<body>
	<a href="/mail/dev.html"><button>Inbox</button></a>
	<a href="/mail/dev.html?spam=true"><button>Spam</button></a>
	<a href="/user/login.html?redirectTo=/mail/dev.html"><button>Log in/out</button></a>
	<a href="/mail/setup.html"><button>Setup</button></a>
	<br/>
	
	<div id="errors"></div>
	<div id="mails"></div>
</body>
</html>